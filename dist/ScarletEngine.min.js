/*! ScarletEngine 2014-09-15 */
var Deg=function(){function a(){}return a.normalize=function(a){return 0>a&&(a+=360*Math.abs(Math.floor(a/360))),a>360&&(a-=360*Math.abs(Math.floor(a/360))),a},a.isWithinRange=function(b,c,d){if(Math.abs(c-b)>=360)return!0;var e=a.normalize(d),f=a.normalize(b);f>e&&(f-=360);var g=a.normalize(c);return f>g?g+=360:g-f>=360&&(g-=360),!(f>e||e>g)},a.toRadians=function(a){return a*Math.PI/180},a}(),Drawable=function(){"use strict";function a(a,b,c){this.childrenabove=[],this.childrenbelow=[],this.alpha=null,this.scaleX=1,this.scaleY=1,this.centerX=a,this.centerY=b,this.position=new Vector2D,this.rotation=new Vector2D,this.rotation.normalize(),this.parent=null,this.rotationOffset=Deg.toRadians(c||0),this.clamps={active:!1,min:0,max:0,mid:0,absolute:!1},this.collision={active:!1}}a.prototype.setCollisionBox=function(a,b,c,d,e){e&&(a-=this.centerX,c-=this.centerX,b-=this.centerY,d-=this.centerY);var f=new Vector2D((a+c)/2,(b+d)/2),g=new Vector2D(a,b),h=f.distance(g);return this.collision={active:!0,x1:Math.min(a,c),y1:Math.min(b,d),x2:Math.max(a,c),y2:Math.max(b,d),center:f,length:h},this},a.prototype.collisionMode=function(a){a?this.collision.x1&&(this.collision.active=!0):this.collision.active=!1},a.prototype.getAbsoluteCollisionBox=function(){var a=this.getAbsolutePosition(),b=this.getAbsoluteAngle(),c=new Vector2D(this.collision.x1*this.scaleX,this.collision.y1*this.scaleY),d=new Vector2D(this.collision.x1*this.scaleX,this.collision.y2*this.scaleY),e=new Vector2D(this.collision.x2*this.scaleX,this.collision.y2*this.scaleY),f=new Vector2D(this.collision.x2*this.scaleX,this.collision.y1*this.scaleY);return c.addAngle(b).add(a),d.addAngle(b).add(a),e.addAngle(b).add(a),f.addAngle(b).add(a),[c,d,e,f]},a.prototype.getAbsoluteCollisionCircle=function(){var a=this.getAbsolutePosition(),b=this.getAbsoluteAngle();return{center:this.collision.center.cloneVector().addAngle(b).add(a),length:this.collision.length}},a.prototype.collidesWith=function(a){var b=this.getAbsoluteCollisionCircle(),c=a.getAbsoluteCollisionCircle(),d=b.length+c.length;return b.center.distance(c.center)>d?!1:this.rectCollidesWithRect(a)},a.prototype.rectCollidesWithRect=function(a){var c,d=this.getAbsoluteCollisionBox(),e=a.getAbsoluteCollisionBox();return(c=b(d[0],d[1],e))&&(c=b(d[1],d[2],e))&&(c=b(e[0],e[1],d))?c=b(e[1],e[2],d):!1};var b=function(a,b,c){var d=b.cloneVector().subtract(a),e=d.dotProduct(d),f=Math.min(0,e);e=Math.max(0,e);var g=c[0].cloneVector().subtract(a),h=d.dotProduct(g);if(h>=f&&e>=h)return!0;for(var i=h,j=h,k=1;4>k;k++){if(g=c[k].cloneVector().subtract(a),h=d.dotProduct(g),h>=f&&e>=h)return!0;i=Math.min(i,h),j=Math.max(j,h)}return Math.isOverlapping(f,e,i,j)};return a.prototype.isPointingAt=function(a,b){b=b||0;var c=a.getAbsolutePosition();c.subtract(this.getAbsolutePosition());var d=c.getAngleDegrees(),e=this.getAbsoluteAngleDegrees(),f=e-b,g=e+b;return Deg.isWithinRange(f,g,d)},a.prototype.setContext=function(a){this.ctx=a,this.draw=this._draw;for(var b=0;b<this.childrenabove.length;b++)this.childrenabove[b].setContext(this.ctx);for(b=0;b<this.childrenbelow.length;b++)this.childrenbelow[b].setContext(this.ctx);return this},a.prototype.setRotationOffset=function(a){return this.rotationOffset=a,this.changed(),this},a.prototype.setRotationOffsetDegrees=function(a){return this.setRotationOffset(Deg.toRadians(a))},a.prototype.setClamps=function(a,b,c){return a/=Math.PI,b/=Math.PI,this.setClampsPI(a,b,c)},a.prototype.setClampsPI=function(a,b,c){a=(a%2+2)%2,a>1&&(a-=2),a>b&&(a-=2);var d=((a+b)/2+1)%2;return this.clamps={active:!0,min:a,max:b,mid:d,absolute:!!c},this},a.prototype.setClampsDegrees=function(a,b,c){return this.setClampsPI(a/180,b/180,c)},a.prototype.removeClamps=function(){return this.clamps={active:!1,min:0,max:0,mid:0,absolute:!1},this},a.prototype.setAlpha=function(a){return this.alpha=a,this.changed(),this},a.prototype.setScale=function(a,b){return this.scaleX=a,this.scaleY=b||a,this.changed(),this},a.prototype.addChild=function(a,b){return b?this.childrenabove.push(a):this.childrenbelow.push(a),a.setContext(this.ctx),a.setParent(this),a.setPlayArea(this.playArea),this},a.prototype.removeChild=function(a){this.childrenabove.indexOf(a)>-1?this.childrenabove.splice(this.childrenabove.indexOf(a),1):this.childrenbelow.indexOf(a)>-1&&this.childrenbelow.splice(this.childrenbelow.indexOf(a),1)},a.prototype.kill=function(){"undefined"!=typeof this.parent&&null!==this.parent&&this.parent.removeChild(this);var a=this.childrenabove.concat(this.childrenbelow);return this.childrenabove=[],this.childrenbelow=[],a.forEach(function(a){a.parent=null,a.kill()}),this.ctx=null,this.draw=function(){},this.changed(),this.parent=null,null},a.prototype.setParent=function(a){return null!==this.parent&&this.parent.removeChild(this),this.parent=a,this},a.prototype.setCoords=function(a){return Array.isArray(a)?(this.position.setX(a[0]),this.position.setY(a[1])):(this.position.setX(a.x),this.position.setY(a.y)),this.changed(),this},a.prototype.addCoords=function(a){return this.position.add(a),this.changed(),this},a.prototype.setPlayArea=function(a){this.playArea=a,this.childrenabove.forEach(function(b){b.setPlayArea(a)}),this.childrenbelow.forEach(function(b){b.setPlayArea(a)})},a.prototype.getCoordArray=function(){return this.position.getCoordArray()},a.prototype.getCoordObj=function(){return this.position.getCoordObj()},a.prototype.setAngle=function(a){return this.clamps.active&&!this.clamps.absolute&&(a=this.clamp(a)),this.rotation.setAngle(a),this.changed(),this},a.prototype.calcAngle=function(a){return this.clamps.active&&!this.clamps.absolute&&(a=this.clamp(a)),this.rotation.cloneVector().setAngle(a)},a.prototype.setAngleDegrees=function(a){return this.rotation.setAngleDegrees(a),this.changed(),this},a.prototype.setAbsoluteAngle=function(a){return this.clamps.active&&this.clamps.absolute?a=this.clamp(a-(this.getAbsoluteAngle()-this.getAngle())):a-=this.getAbsoluteAngle()-this.getAngle(),this.setAngle(a)},a.prototype.calcAbsoluteAngle=function(a){return this.clamps.active&&this.clamps.absolute?a=this.clamp(a-(this.getAbsoluteAngle()-this.getAngle())):a-=this.getAbsoluteAngle()-this.getAngle(),this.calcAngle(a)},a.prototype.setAbsoluteAngleDegrees=function(a){return this.setAbsoluteAngle(Deg.toRadians(a))},a.prototype.getAngle=function(){return this.rotation.getAngle()},a.prototype.getAngleDegrees=function(){return this.rotation.getAngleDegrees()},a.prototype.clamp=function(a){var b=this.clamps.min,c=this.clamps.max;if(a/=Math.PI,a=(a%2+2)%2,b>a&&(a+=2),0!==this.clamps.mid&&a>this.clamps.mid&&c>b&&(a-=2),0!==this.clamps.mid&&a<this.clamps.mid&&b>c&&(a+=2),Math.abs(b-a)<Math.abs(c-a)){if(b>a)return b*Math.PI}else if(a>c)return c*Math.PI;return a*Math.PI},a.prototype.pointAt=function(a){var b;b=Array.isArray(a)?new Vector2D(a[0],a[1]):new Vector2D(a.x,a.y);var c=b.subtract(this.getAbsolutePosition());this.setAbsoluteAngle(c.getAngle())},a.prototype.pointer=function(a){var b;b=Array.isArray(a)?new Vector2D(a[0],a[1]):new Vector2D(a.x,a.y);var c=b.subtract(this.getAbsolutePosition());return this.calcAbsoluteAngle(c.getAngle())},a.prototype.getAbsolutePosition=function(a){return a=a||new Vector2D(0,0),"undefined"!=typeof this.parent&&null!==this.parent?(a._x=a._x*this.scaleX,a._y=a._y*this.scaleY,a=a.addAngle(this.rotation.getAngle()).add(this.position),this.parent.getAbsolutePosition(a)):a.addAngle(this.rotation.getAngle()).add(this.position)},a.prototype.getAbsoluteRotation=function(a){return a=a||new Vector2D(1,0),"undefined"!=typeof this.parent&&null!==this.parent?(a=a.addAngle(this.rotation.getAngle()),this.parent.getAbsoluteRotation(a)):a.addAngle(this.rotation.getAngle())},a.prototype.getAbsoluteCoordArray=function(){return this.getAbsolutePosition().getCoordArray()},a.prototype.getAbsoluteCoordObj=function(){return this.getAbsolutePosition().getCoordObj()},a.prototype.getAbsoluteAngle=function(){return this.getAbsoluteRotation().getAngle()},a.prototype.getAbsoluteAngleDegrees=function(){return this.getAbsoluteRotation().getAngleDegrees()},a.prototype.changed=function(){"undefined"!=typeof this.playArea&&null!==this.playArea&&this.playArea.changed()},a.prototype.draw=function(){},a.prototype._draw=function(){this.ctx.save();var a=this.position.getCoordObj();if(this.ctx.translate(a.x,a.y),null!==this.alpha&&(this.ctx.globalAlpha=this.alpha),this.ctx.scale(this.scaleX,this.scaleY),window.debug&&this.clamps.active){var b=new Vector2D(1,0),c=new Vector2D(1,0),d=new Vector2D(1,0);b.setLength(50),c.setLength(100),d.setLength(100),b.setAngle(this.clamps.mid*Math.PI),c.setAngle(this.clamps.min*Math.PI),d.setAngle(this.clamps.max*Math.PI),this.clamps.absolute&&(b.addAngle(-this.getAbsoluteAngle()).addAngle(this.getAngle()),c.addAngle(-this.getAbsoluteAngle()).addAngle(this.getAngle()),d.addAngle(-this.getAbsoluteAngle()).addAngle(this.getAngle()));var e=b.getCoordObj(),f=c.getCoordObj();this.ctx.save(),this.ctx.fillStyle="rgba(90,10,10,.2)",this.ctx.strokeStyle="#000000",this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(0,0),this.ctx.lineTo(f.x,f.y),this.ctx.arc(0,0,100,c.getAngle(),d.getAngle()),this.ctx.lineTo(0,0),this.ctx.stroke(),this.ctx.fill(),this.ctx.restore()}this.ctx.rotate(this.rotation.getAngle()),window.debug&&this.collision.active&&(this.ctx.save(),this.ctx.strokeStyle="#FF0000",this.ctx.alpha=0,this.ctx.moveTo(this.collision.x1,this.collision.y1),this.ctx.lineTo(this.collision.x2,this.collision.y1),this.ctx.lineTo(this.collision.x2,this.collision.y2),this.ctx.lineTo(this.collision.x1,this.collision.y2),this.ctx.lineTo(this.collision.x1,this.collision.y1),this.ctx.stroke(),this.ctx.restore()),this.childrenbelow.forEach(function(a){a.draw()}),this.ctx.rotate(this.rotationOffset),this.drawSelf&&this.drawSelf(),this.ctx.rotate(-this.rotationOffset),this.childrenabove.forEach(function(a){a.draw()}),this.ctx.restore()},a}(),IKSolver=function(){"use strict";function a(a,b){this.segments=[];var c=b,d=0;this.totalLength=0;do if(c.IK={length:d},this.totalLength+=d,this.segments.push(c),d=c.position.getLength(),c=c.parent,!(c instanceof Drawable))throw"Base not found";while(c!==a);c.IK={length:d},this.totalLength+=d,this.segments.push(c)}return a.circleIntersect=function(a,b,c,d){var e=c._x-a._x,f=c._y-a._y,g=Math.sqrt(f*f+e*e);if(g>b+d)return null;if(g<Math.abs(b-d))return null;var h=(b*b-d*d+g*g)/(2*g),i=a._x+e*h/g,j=a._y+f*h/g,k=Math.sqrt(b*b-h*h),l=-f*(k/g),m=e*(k/g),n=new Vector2D(i+l,j+m),o=new Vector2D(i-l,j-m);return[n,o]},a.prototype.bsolve=function(b){var c;c=Array.isArray(b)?new Vector2D(b[0],b[1]):new Vector2D(b.x,b.y);for(var d=this.totalLength,e=this.segments.length-1;e>0;e--){var f=this.segments[e],g=d/2,h=g;g<this.segments[e-1].IK.length&&(g=this.segments[e-1].IK.length),h<f.IK.length&&(h=f.IK.length);var i=f.getAbsoluteCoordObj(),j=new Vector2D(i.x,i.y),k=a.circleIntersect(c,g,j,h);f.pointAt(null===k?c.getCoordObj():k[0].getCoordObj()),d-=f.IK.length}},a.prototype.solve=function(a){var b,c;for(b=Array.isArray(a)?new Vector2D(a[0],a[1]):new Vector2D(a.x,a.y),f=this.segments.length-1;f>=0;f--)c=this.segments[f],c.pointAt(b.getCoordObj());for(var d=b.cloneVector(),e=0,f=0;f<this.segments.length;f++){c=this.segments[f];var g=c.getAbsoluteCoordObj(),h=new Vector2D(g.x,g.y),i=Vector2D.angleBetween(d,h),j=new Vector2D(-1,0);j.setAngle(i),j.setLength(e),d.add(j),this.segments[f].newposition=d.cloneVector(),e=c.position.getLength()}for(f=this.segments.length-1;f>=0;f--){c=this.segments[f];var k=f>0?this.segments[f-1].newposition.getCoordObj():b.getCoordObj();c.pointAt(k)}},a}();Math.TAU||(Math.TAU=2*Math.PI),Math.squared||(Math.squared=function(a){return a*a}),Math.isOverlapping||(Math.isOverlapping=function(a,b,c,d){return Math.max(a,c)<=Math.min(b,d)}),Math.rnd||(Math.rnd=function(a,b){return b?(b++,Math.floor(Math.random()*(b-a))+a):(a++,Math.floor(Math.random()*a))});var Mural=function(){"use strict";function a(a,b,c){this.canvas=document.querySelector(a),this.context=this.canvas.getContext("2d"),this.smooth=b,this.context.imageSmoothingEnabled=!!b,this.context.mozImageSmoothingEnabled=!!b,this.context.oImageSmoothingEnabled=!!b,this.context.webkitImageSmoothingEnabled=!!b,this.playAreas=[],this.immediate=!!c,this.hasChanged=!1,this.mouseposition={x:0,y:0},this.canvas.addEventListener("mousemove",this.mousePos.bind(this)),this.animlist=[]}return a.prototype.hidePointer=function(){this.canvas.style.cursor="none"},a.prototype.showPointer=function(){this.canvas.style.cursor="default"},a.prototype.mousePos=function(a){var b=this.canvas.getBoundingClientRect();this.mouseposition={x:a.clientX-b.left,y:a.clientY-b.top}},a.prototype.getMousePosition=function(){return this.mouseposition},a.prototype.addPlayArea=function(a,b,c,d){a=a||0,b=b||0,c=this.context.canvas.width||0,d=d||this.context.canvas.height;var e=document.createElement("canvas");e.width=c,e.height=d;var f=new PlayArea(e,a,b,this.smooth,this.immediate);return this.playAreas.push(f),f.setParent(this),this.changed(),f},a.prototype.changed=function(){this.hasChanged=!0,this.immediate&&setTimeout(this.redraw.bind(this),0)},a.prototype.redraw=function(a){(this.hasChanged||a)&&(this.draw(a),this.hasChanged=!1)},a.prototype.draw=function(a){this.context.moveTo(0,0),this.playAreas.forEach(function(b){b.draw(a)}),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);var b=this;this.playAreas.forEach(function(a){b.context.drawImage(a.canvas,a.x,a.y)})},a.prototype.animate=function(a){-1===this.animlist.indexOf(a)&&this.animlist.push(a)},a.prototype.removeAnimation=function(a){-1!==this.animlist.indexOf(a)&&this.animlist.splice(this.animlist.indexOf(a),1)},a}();Object.clone=function(a){if(null===a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)b[c]=Object.clone(a[c]);return b},Object.merge=function(a,b){var c=Object.clone(a);for(var d in b)b[d]&&b[d].constructor===Object?(a[d]||(a[d]={}),c[d]=Object.merge(a[d],b[d])):c[d]=b[d];return c};var PlayArea=function(){"use strict";function a(a,b,c,d,e){this.canvas=a,this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!!d,this.ctx.mozImageSmoothingEnabled=!!d,this.ctx.oImageSmoothingEnabled=!!d,this.ctx.webkitImageSmoothingEnabled=!!d,this.x=b,this.y=c,this.immediate=e,this.objects=[],this.hasChanged=!1}return a.prototype.getMousePosition=function(){var a=this.parent.getMousePosition();return a.x-=this.x,a.y-=this.y,a},a.prototype.addChild=function(a,b){b=b||0,this.objects[b]||(this.objects[b]=[]),this.objects[b].push(a),a.setParent(this),a.setContext(this.ctx),a.setPlayArea(this)},a.prototype.removeChild=function(a){var b=this.objects.some(function(b){return b.indexOf(a)>-1?(b.splice(b.indexOf(a),1),!0):void 0});if(b!==!0)throw"Child not found"},a.prototype.setParent=function(a){this.parent=a},a.prototype.changed=function(){this.hasChanged=!0,"undefined"!=typeof this.parent&&null!==this.parent&&this.parent.changed()},a.prototype.draw=function(a){(this.hasChanged||a)&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.moveTo(0,0),this.objects.forEach(function(a){a.forEach(function(a){a.draw()})}),this.hasChanged=!1)},a.prototype.getAbsolutePosition=function(a){return a},a.prototype.getAbsoluteRotation=function(a){return a},a.prototype.getAbsoluteAngle=function(){return 0},a.prototype.animate=function(a){this.parent.animate(a)},a.prototype.removeAnimation=function(a){this.parent.removeAnimation(a)},a}(),Poly=function(){"use strict";function a(a,b){a=a||0,b=b||0,Drawable.apply(this,[a,b]),this.points=[],this._fillStyle=null,this._lineWidth=null,this._shadow=null,this._strokeStyle=null}return a.prototype=Object.create(Drawable.prototype),a.prototype.addPoint=function(a,b){return this.points.push([a,b]),this.changed(),this},a.prototype.getPoint=function(a){return a>=0&&a<this.points.length?this.points[a]:null},a.prototype.changePoint=function(a,b,c){return a>=0&&a<this.points.length&&(Array.isArray(b)||(b=[b,c]),this.points[a]=b),this.changed(),this},a.prototype.fillStyle=function(a){return this._fillStyle=a,this.changed(),this},a.prototype.usePattern=function(a){this.pattern=new Image,this.pattern.src=a,this.loaded=!1,this.pattern.addEventListener("load",function(){this.loaded=!0}.bind(this))},a.prototype.patternTranslate=function(a,b){("undefined"==typeof this.translate||null===this.translate)&&(this.translate={x:0,y:0}),this.translate.x=a||this.translate.x,this.translate.y=b||this.translate.y},a.prototype.relativePatternTranslate=function(a,b){("undefined"==typeof this.translate||null===this.translate)&&(this.translate={x:0,y:0}),a&&(this.translate.x=this.translate.x+a),b&&(this.translate.y=this.translate.y+b)},a.prototype.lineWidth=function(a){return this._lineWidth=a,this.changed(),this},a.prototype.strokeStyle=function(a){return this._strokeStyle=a,this.changed(),this},a.prototype.shadow=function(a){return this._shadow=a,this.changed(),this},a.prototype.drawSelf=function(){var a=this.ctx;null!==this.pattern&&this.loaded?a.fillStyle=a.createPattern(this.pattern,"repeat"):null!==this._fillStyle&&(a.fillStyle=this._fillStyle),null!==this._lineWidth&&(a.lineWidth=this._lineWidth),null!==this._strokeStyle&&(a.strokeStyle=this._strokeStyle),null!==this._shadow&&(a.shadowOffsetX=this._shadow.x,a.shadowOffsetY=this._shadow.y,a.shadowBlur=this._shadow.blur,a.shadowColor=this._shadow.color),a.beginPath();var b=this;this.points.forEach(function(c){a.lineTo(c[0]-b.centerX,c[1]-b.centerY)}),this.points.length>2&&a.lineTo(this.points[0][0]-this.centerX,this.points[0][1]-this.centerY),null!==this._strokeStyle&&a.stroke(),(null!==this._fillStyle||null!==this.pattern)&&this.points.length>2&&(this.translate&&(a.save(),a.translate(this.translate.x,this.translate.y)),a.fill(),this.translate&&a.restore())},a}(),ScarletEngine=function(){"use strict";function a(b,c){this.mural=b,this.gameloop=c||a.defaultLoop,this.startTime=null,this.prevtime=null,this.run=!0,this.keys={},this.frameLength=1e3/60,this.ticksover=0,this.totalticksover=0,this.keyCodes=[],document.addEventListener("keydown",this.keyDown.bind(this)),document.addEventListener("keyup",this.keyUp.bind(this))}return window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,a.prototype.registerKeys=function(a){a.forEach(this.registerKey.bind(this))},a.prototype.registerKey=function(a){-1===this.keyCodes.indexOf(a)&&this.keyCodes.push(a)},a.prototype.releaseKey=function(a){-1!==this.keyCodes.indexOf(a)&&this.keyCodes.splice(this.keys.indexOf(a),1)},a.prototype.keyDown=function(a){var b=a.which?a.which:event.keyCode;-1!==this.keyCodes.indexOf(b)&&(this.keys[b]="new",a.stopPropagation(),a.preventDefault())},a.prototype.keyUp=function(a){var b=a.which?a.which:event.keyCode;delete this.keys[""+b],-1!==this.keyCodes.indexOf(b)&&(a.stopPropagation(),a.preventDefault())},a.prototype.isKey=function(a,b){b=!!b;var c=this.keys[a],d=!1;return c&&("new"==c?d=!0:b||(d=!0),this.keys[a]="old"),d},a.defaultLoop=function(){},a.prototype.mainLoop=function(a){var b,c;null===this.startTime&&(this.startTime=a),null===this.prevtime&&(this.prevtime=a),b=a-this.startTime,c=a-this.prevtime,this.prevtime=a;var d=Math.round((c+this.ticksover)/this.frameLength);this.ticksover=c+this.ticksover-d*this.frameLength;var e=Math.round((b+this.totalticksover)/this.frameLength);this.totalticksover=b+this.totalticksover-e*this.frameLength;for(var f=0;f<this.mural.animlist.length;f++)this.mural.animlist[f].addTicks(d);this.gameloop({progress:b,moment:c,ticks:d,totalTicks:e,isKey:this.isKey.bind(this)}),this.mural.redraw(),this.run&&window.requestAnimationFrame(this.mainLoop.bind(this))},a.prototype.start=function(){this.run=!0,this.startTime=null,this.prevtime=null,window.requestAnimationFrame(this.mainLoop.bind(this))},a.prototype.stop=function(){this.run=!1},a}(),Sprite=function(){"use strict";function a(a,b,c,d,e,f){Drawable.apply(this,[d,e,f]),this.image=new Image,this.loaded=!1,this.image.addEventListener("load",function(){this.loaded=!0,this.tileWidth=Math.floor(this.image.width/this.width)}.bind(this)),this.image.src=a,this.width=b,this.height=c,this.frame=0,this.animations={},this.currentAnimation=null,this.animationIndex=0,this.tickSpeed=1,this.tick=0}return a.prototype=Object.create(Drawable.prototype),a.prototype.setFrame=function(a){return this.frame=a,this.changed(),this},a.prototype.setSpeed=function(a){return this.tickSpeed=a,this},a.prototype.addTicks=function(a){for(this.tick+=a;this.tick>this.tickSpeed;)this.advanceAnimationFrame(),this.tick-=this.tickSpeed;return this},a.prototype.autoAnim=function(a){return a?this.playArea.animate(this):this.playArea.removeAnimation(this),this},a.prototype.addAnimation=function(a,b,c){return c=c||function(){},this.animations[a]={frames:b,callback:c},this},a.prototype.setAnimationCallback=function(a,b){return this.animations[a]&&(this.animations[a].callback=b),this},a.prototype.startAnimation=function(a){return this.animations[a]&&(this.currentAnimation=this.animations[a],this.animationIndex=0),this},a.prototype.stopAnimation=function(){return this.currentAnimation=null,this},a.prototype.advanceAnimationFrame=function(){if(null!==this.currentAnimation)if(this.animationIndex++,this.animationIndex>=this.currentAnimation.frames.length&&(setTimeout(function(){this.currentAnimation.callback.call(null,this)}.bind(this),0),this.animationIndex=0),-1===this.currentAnimation.frames[this.animationIndex]){var a=this.currentAnimation.callback;this.stopAnimation(),setTimeout(function(){a.call(null,this)}.bind(this),0)}else this.frame=this.currentAnimation.frames[this.animationIndex];return this},a.prototype.drawSelf=function(){if(this.loaded){for(var a=this.frame,b=0;a>=this.tileWidth;)b++,a-=this.tileWidth;this.ctx.drawImage(this.image,a*this.width,b*this.height,this.width,this.height,-this.centerX,-this.centerY,this.width,this.height)}},a}(),Vector2D=function(){"use strict";function a(a,b){this._x=a||0,this._y=b||0}return a.prototype.setY=function(a){this._y=a},a.prototype.getY=function(){return this._y},a.prototype.setX=function(a){this._x=a},a.prototype.getX=function(){return this._x},a.prototype.getCoordArray=function(){return[this._x,this._y]},a.prototype.getCoordObj=function(){return{x:this._x,y:this._y}},a.prototype.cloneVector=function(){return new a(this._x,this._y)},a.prototype.zeroVector=function(){return this._x=0,this._y=0,this},a.prototype.isZero=function(){return 0===this._x&&0===this._y},a.prototype.isNormalized=function(){return 1==this.getLength()},a.prototype.equals=function(a){return this._x==a.getX()&&this._y==a.getY()},a.prototype.getLengthSquared=function(){return Math.squared(this._x)+Math.squared(this._y)},a.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},a.prototype.setLength=function(a){var b=this.getAngle();this._x=Math.cos(b)*a,this._y=Math.sin(b)*a,Math.abs(this._x)<1e-8&&(this._x=0),Math.abs(this._y)<1e-8&&(this._y=0)},a.prototype.getAngle=function(){return Math.atan2(this._y,this._x)},a.prototype.getAngleDegrees=function(){var a=this.getAngle();return a=360*(a>0?a:2*Math.PI+a)/(2*Math.PI)},a.prototype.setAngle=function(a){var b=this.getLength();return this._x=Math.cos(a)*b,this._y=Math.sin(a)*b,this},a.prototype.setAngleDegrees=function(a){return this.setAngle(Deg.toRadians(a))},a.prototype.addAngle=function(a){var b=this.getAngle();return b+=a,this.setAngle(b),this},a.prototype.addAngleDegrees=function(a){return this.addAngle(Deg.toRadians(a))},a.prototype.normalize=function(){var a=this.getLength();return 0===a?(this._x=1,this):(this._x/=a,this._y/=a,this)},a.prototype.normalcate=function(a){return this.setLength(a),this},a.prototype.truncate=function(a){return this.setLength(Math.min(a,this.getLength())),this},a.prototype.reverse=function(){return this._x=-this._x,this._y=-this._y,this},a.prototype.dotProduct=function(a){return this._x*a._x+this._y*a._y},a.prototype.crossProduct=function(a){return this._x*a._y-this._y*a._x},a.angleBetween=function(a,b){return a.isNormalized()||(a=a.cloneVector().normalize()),b.isNormalized()||(b=b.cloneVector().normalize()),Math.acos(a.dotProduct(b))},a.prototype.getPerpendicular=function(){return new a(-this._y,this._x)},a.prototype.sign=function(a){return this.getPerpendicular().dotProduct(a)<0},a.prototype.distance=function(a){return Math.sqrt(this.distSQ(a))},a.prototype.distSQ=function(a){var b=a.getX()-this._x,c=a.getY()-this._y;return Math.squared(b)+Math.squared(c)},a.prototype.add=function(a){return this._x+=a.getX(),this._y+=a.getY(),this},a.prototype.subtract=function(a){return this._x-=a.getX(),this._y-=a.getY(),this},a.prototype.multiply=function(a){return this._x*=a,this._y*=a,this},a.prototype.divide=function(a){return this._x/=a,this._y/=a,this},a}(),TouchControls=function(){function a(){this.winwidth=window.innerWidth,this.winheight=window.innerHeight,this.elements=[],this.testTouch=null,this.callback=null,this.looper=null}return window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,1)},50)},!1),a.JOYSTICK=0,a.BUTTON=1,a.CONTINUOUSBUTTON=2,a.prototype.addElement=function(b,c,d){console.log(c);var e={name:b,element:c,type:d,x1:0,y1:0,x2:0,y2:0};d===a.BUTTON&&(e.fire=!1,e.previous=!1),this.elements.push(e),this.calcElement(this.elements.length-1)},a.prototype.isElement=function(b){for(var c=0;c<this.elements.length;c++){var d=this.elements[c];if(d.name===b){if(d.type===a.BUTTON)return d.fire===d.previous?!1:(this.elements[c].previous=d.fire,d.fire);if(d.type===a.CONTINUOUSBUTTON){var e=d.fire;return this.elements[c].fire=!1,e}if(d.type===a.JOYSTICK)return d.touched}}return!1},a.prototype.calcElement=function(b){var c=this.elements[b];if(c.element instanceof HTMLElement){var d=a.getOffset(c.element);c.x1=d.left,c.y1=d.top,c.x2=d.left+c.element.offsetWidth,c.y2=d.top+c.element.offsetHeight,console.log(c)}},a.prototype.calcElements=function(){for(var a=0;a<this.elements.length;a++)this.calcElement(a)},a.prototype.start=function(a,b){this.calcElements(),this.winwidth=window.innerWidth,this.winheight=window.innerHeight,this.bindedcontrols=this.controls.bind(this),this.bindedorientation=this.doOnOrientationChange.bind(this),document.addEventListener("touchstart",this.bindedcontrols,!1),document.addEventListener("touchend",this.bindedcontrols,!1),document.addEventListener("touchmove",this.bindedcontrols,!1),document.addEventListener("touchenter",this.bindedcontrols,!1),document.addEventListener("touchleave",this.bindedcontrols,!1),document.addEventListener("touchcancel",this.bindedcontrols,!1),window.addEventListener("resize",this.bindedorientation,!1),this.callback=a,this.looper=setInterval(this.detectionLoop.bind(this),b||16)},a.prototype.stop=function(){document.removeEventListener("touchstart",this.bindedcontrols,!1),document.removeEventListener("touchend",this.bindedcontrols,!1),document.removeEventListener("touchmove",this.bindedcontrols,!1),document.removeEventListener("touchenter",this.bindedcontrols,!1),document.removeEventListener("touchleave",this.bindedcontrols,!1),document.removeEventListener("touchcancel",this.bindedcontrols,!1),window.removeEventListener("resize",this.bindedorientation,!1),null!==this.looper&&(clearInterval(this.looper),this.looper=null)},a.prototype.detectionLoop=function(){var b,c=null;if(null!==this.testTouch){for(var d=0;d<this.testTouch.length;d++)for(var e=this.testTouch[d],f=0;f<this.elements.length;f++)b=this.elements[f],e.clientY>b.y1&&e.clientY<b.y2&&e.clientX>b.x1&&e.clientX<b.x2&&(b.type===a.BUTTON?this.elements[f].update={fire:!0}:b.type===a.CONTINUOUSBUTTON?this.elements[f].update={fire:!0}:b.type===a.JOYSTICK&&(this.elements[f].update=b.update||[],this.elements[f].update.push({x:e.clientX,y:e.clientY})));for(c=0;c<this.elements.length;c++){if(b=this.elements[c],b.type===a.BUTTON)this.elements[c].fire=b.update?b.update.fire:!1;else if(b.type===a.CONTINUOUSBUTTON)b.update&&(this.elements[c].fire=!0);else if(b.type===a.JOYSTICK)if(b.update){for(var g=0,h=0,i=0;i<b.update.length;i++)g+=b.update[i].x,h+=b.update[i].y;g/=b.update.length,h/=b.update.length,g-=b.x1,h-=b.y1,g=g/(b.x2-b.x1)*200-100,h=h/(b.y2-b.y1)*200-100,this.elements[c].touched={x:g,y:-h}}else this.elements[c].touched=!1;this.elements[c].update=!1}}else for(c=0;c<this.elements.length;c++)switch(b=this.elements[c],b.type){case a.BUTTON:case a.CONTINUOUSBUTTON:this.elements[c].fire=!1;continue;case a.JOYSTICK:this.elements[c].touched=!1}null!==this.callback&&"function"==typeof this.callback&&this.callback(this)},a.prototype.controls=function(a){this.testTouch=a.touches.length>0?a.touches:null,a.preventDefault()},a.prototype.doOnOrientationChange=function(){console.log("OrientationChange"),this.winwidth=window.innerWidth,this.winheight=window.innerHeight,this.calcElements()},a.getOffset=function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}},a}();